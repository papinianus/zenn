---
title: 'Google Colab ã‹ã‚‰ Pleasanter ã«æ¥ç¶šã—ã‚ˆã†ã¨ã—ãŸã‚‰ã§ããªã‹ã£ãŸã®ã§ JupyterNotebook ã§ãªã‚“ã¨ã‹ã—ãŸ'
emoji: 'ğŸŠ'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['python', 'pleasanter', 'excel', 'jupyter']
published: true
---

[2022 å€‹äººã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼](https://qiita.com/advent-calendar/2022/papinianus) ã®è¨˜äº‹ã§ã™ã€‚

## èª²é¡Œæ„Ÿ

- Excel å¸³ç¥¨ã‚„ã‚ã‚ˆã†
  - DX ã¨ã‹ã£ã¦ãƒã‚ºãƒ¯ãƒ¼ãƒ‰ã¯ã„ã„ã‹ã‚‰æ¥­å‹™ã‚’ã‚¯ãƒ©ã‚¦ãƒ‰ãƒã‚¤ãƒ†ã‚£ãƒ–ã«æ”¹ã‚ã‚‹ã‚“ã 
- ã¨ã¯ã„ã£ã¦ã‚‚ Excel å‡ºã—ãŸã„ã‚‰ã—ã„
- ãã‚Œã§ãã‚‹ã‚ˆ Python ãªã‚‰ã­
  - ~~Colab ã§ã‚„ã‚Œã°ç’°å¢ƒãŠæ‰‹è»½ã§ã¯~~

## è©¦ã—ãŸã“ã¨

- Google Colab ã‹ã‚‰ demo.pleasanter.org ã«ç¹‹ã’ãªã‹ã£ãŸ
- Jupyter Notebook ã‚’ã‚³ãƒ³ãƒ†ãƒŠã§èµ·å‹•ã—ã¦ Excel å¸³ç¥¨å‡ºåŠ›

## Colab

- è¨¼æ˜æ›¸ã®ã‚¨ãƒ©ãƒ¼

æ™®é€šã« `requests.post` ã™ã‚‹ã¨ â†“ ãªã‚‹

> SSLCertVerificationError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (\_ssl.c:1131)

ã®ã§

```python
import requests
import json
import urllib3

urllib3.disable_warnings()

request_param = {
    "ApiVersion": 1.1,
    "ApiKey": apikey
}
response = requests.post(
    f'https://demo.pleasanter.org/api/items/123123/get', json=request_param)
print(response.text)
```

ã¨ã™ã‚‹ã¨

```text
<html>
<head><title>403 Forbidden</title></head>
<body>
<center><h1>403 Forbidden</h1></center>
<hr><center>Microsoft-Azure-Application-Gateway/v2</center>
</body>
</html>
```

ã¨ãªã‚Š Azure ã® WAF ã§é®æ–­ã•ã‚Œã¦ã„ãŸâ€¦
(ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ–¹æ³•ãŒé–“é•ã£ã¦ã„ã‚‹ã®ã‹ã¨ã€åˆ¥é€”ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰å®Ÿæ–½ã—ãŸã‚Šã—ã¦æ™‚é–“ã‚’æº¶ã‹ã—ãŸ)

- è£œè¶³
  Local ã® Jupyter ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‚åŒã˜ã 403 ã¨ãªã£ãŸã€‚
  Local ãªã®ã§ `pip install --upgrade certifi` `pip install --upgrade requests` ã—ãŸãŒ SSL ã‚¨ãƒ©ãƒ¼å›é¿ã§ããšã€‚
  ãƒ¢ãƒ¤ã‚‹ãŒã€ã“ã“ã‚’æ˜ã‚Šä¸‹ã’ã‚‹ä½™è£•ãªã„ã®ã§èª¿æŸ»ã›ãšã€‚

## Jupyter Notebook

### ç’°å¢ƒæ§‹ç¯‰

```yaml:docker-compose.yaml
version: "3"
services:
  jupyter:
    image: jupyter/minimal-notebook
    user: root
    ports:
      - '8888:8888'
    environment:
      - GRANT_SUDO=yes
      - TZ=Asia/Tokyo
    volumes:
      - ./work:/home/jovyan/work
```

```zsh
mkdir work
finch compose up
```

â†’ ãƒˆãƒ¼ã‚¯ãƒ³ä»˜ãã® URL ã‚’é–‹ã‘ã°ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã€‚

#### å‚è€ƒ

docker-compose.yml ãƒ¬ãƒ™ãƒ«ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’åˆ†é›¢ã—ã¦ã„ã‚‹å ´åˆã€compose å¤–ã§ä½œæˆã—ãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å‚åŠ ã•ã›ã¦ã‚ã’ã‚‹ã¨ã‚ˆã„ã€‚ã“ã®ã¨ãã€localhost/127.0.0.1 ã§ã¯ãªãã€ã‚³ãƒ³ãƒ†ãƒŠåã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã«ãªã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ã€‚

```zsh
finch network create share-network
```

- [Docker Compose ã§åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ³ãƒ†ãƒŠã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•]https://www.orzs.tech/how-to-access-a-container-of-another-file-with-docker-compose/

### notebook

#### ã‚³ãƒ¼ãƒ‰

- ãƒ–ãƒ­ãƒƒã‚¯ã‚’ 2 ã¤ã«ã‚ã‘ã¦ã„ã¾ã™ã€‚ãƒ˜ãƒ«ãƒ‘ã¨è¨­å®šã‚’ã‚ã‘ã‚‹ãŸã‚
- ã“ã®ä¾‹ã§ã¯
  - work/Book1.xlsx ã¨ã„ã†ãƒ–ãƒƒã‚¯ã® sheet1 ã®ã‚·ãƒ¼ãƒˆã‹ã‚‰
  - `{}`ã§å›²ã¾ã‚ŒãŸå€¤ã®å…¥ã£ãŸã‚»ãƒ«ã‚’æ¢ã—ã¦
  - ãƒ‡ãƒ¼ã‚¿å–å¾—ã—ãŸå†…å®¹ã«ãã®åå‰ã®é …ç›®ãŒã‚ã‚Œã°
- ã¨ã„ã†å‡¦ç†ã‚’ã—ã¦ã„ã¾ã™

```python
import requests

def get_single_record(apikey, id):
    request_param = {
        "ApiVersion": 1.1,
        "ApiKey": apikey,
        "View": {
            "ApiDataType": 'KeyValues'
        }
    }
    response = requests.post(
        f'http://pleasanter-web:5000/api/items/{id}/get', json=request_param, verify=False)
    return response.json()["Response"]["Data"][0]

def is_placeHolder(str):
    return False if str is None else str.startswith("{") and str.endswith("}")


def cell_to_dic(cell):
    return {cell.value[1:-1]: cell.coordinate}


def cells_to_fill(sheet):
    dic = {}
    for row in sheet.iter_rows():
        for cell in row:
            if not (is_placeHolder(cell.value)):
                continue
            dic.update(cell_to_dic(cell))
    return dic

def cells_filled_in(template, data):
    dic = {}
    for k,v in template.items():
        data_value = data.get(k)
        if data_value is None:
            continue
        dic[v] = data_value
    return dic

def write_sheet(sheet,dic):
    for k,v in dic.items():
        sheet[k] = v
```

```python
import requests
import openpyxl

book_name = './work/Book1.xlsx'
sheet_name = 'Sheet1'
id = 51
apikey = "acb8e29f5c98eff25883989a71a1b1cce24b4e92722ca6c7dde0303266a436941baa36aa1a1d3e28c8615b72192217a75a13bc0ea3d383290db02e72e798bba8"

workbook = openpyxl.load_workbook(book_name)
sheet = workbook[sheet_name]
template_dic = cells_to_fill(sheet)
data = get_single_record(apikey, id)
assigned_dic = cells_filled_in(template_dic,data)
new_sheet = workbook.copy_worksheet(sheet)
new_sheet.title = "ã‚³ãƒ”ãƒ¼"
write_sheet(new_sheet, assigned_dic)
workbook.save(book_name)
workbook.close()
```

## ãŠã‚ã‚Šã«

- ç’°å¢ƒã«è‹¦åŠ´ã—ã¦ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’è€ƒãˆã‚‰ã‚Œã¦ã„ãªã„ã€‚
- å®Ÿç”¨çš„ãªæ›¸é¡ã«ã™ã‚‹ã«ã¯ã€å®Ÿéš›ã®å¸³ç¥¨ã«åˆã‚ã›ãŸèª¿æ•´ãŒå¿…è¦
  - æ›¸å¼ã‚„ç½«ç·šã€åŸ‹ã‚ã‚‰ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿é•·ã«ã‚ˆã£ã¦è¡¨ç¤ºãŒå·¦å³ã•ã‚Œã‚‹
  - ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›ç”¨ã®ã‚·ãƒ¼ãƒˆã‚’ä½œã£ã¦ã€ãã“ã‹ã‚‰ã‚»ãƒ«å‚ç…§ã—ã¦è¡¨ç¤ºãƒšãƒ¼ã‚¸ã‚’ä½œã‚‹ã€ãŒç©å½“ãªè§£æ±ºæ–¹æ³•ã‹ã‚‚ã€‚
    - ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›ã‚·ãƒ¼ãƒˆã§ A åˆ—ã«ã ã‘ãƒ‡ãƒ¼ã‚¿ã‚’åŸ‹ã‚ã‚Œã°ã‚ˆã„ã€ã§ã‚ã‚Œã°å‡¦ç†é€Ÿåº¦ã‚‚æ—©ã„ã‹ã‚‚ã€‚
  - ã“ã†ã„ã†æ‰‹å½“ã‚’ã—ã¦ã¾ã§å¸³ç¥¨ã‚’ä½œã‚‰ãªã„ã¨ã„ã‘ãªã„ã‹ã¯å†åº¦æ¤œè¨ã™ã¹ãã€‚
  - â†’ è¦‹ã›ã‚‹ç”»é¢ã‚’ Web ã§ä½œã‚‹ãƒ¡ãƒªãƒƒãƒˆ
    - æ¨©é™ãŒåˆ¶å¾¡ã§ãã‚‹
    - æœ€æ–°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½ã‚ãªãã¦ã„ã„
    - å…±åŒã§ç·¨é›†ã—ãŸå†…å®¹ãŒãã®å ´ãã®å ´ã§å…±æœ‰ã§ãã‚‹
