---
title: 'Pleasanter ã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã—ã‚ˆã†ã¨ã—ãŸã‚‰æ€ã‚ã¬ã¨ã“ã‚ã§ã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸ'
emoji: 'ğŸ’¬'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [pleasanter, docker]
published: true
---

ã“ã‚Œã¯[2023 å€‹äººã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼](https://qiita.com/advent-calendar/2023/doityourself)ã® 1 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

## tl;dr

- å»å¹´ä½œã£ãŸ[ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ„ãƒ¼ãƒ«](https://zenn.dev/ulpianus/articles/9f29694186e70a)ã¯å¼•ãç¶šãä½¿ãˆãŸ
- macOS ã§ç‰¹ã«æ‰‹å½“ã¦ãªãåœ§ç¸®ã—ã¦ã€å±•é–‹ã—ãŸ `._*` ã®ãƒªã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã§ docker ã® dotnet ã‚’èµ·å‹•ã™ã‚‹ã¨ NullReference ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹

## ä»Šå›ã®ç›®çš„

ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«å‘ã‘ã¦ã€æ‰‹å…ƒã®ãƒ—ãƒªã‚¶ãƒ³ã‚¿ãƒ¼ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨æ€ã„ã¾ã—ãŸã€‚

æ‰‹å…ƒç’°å¢ƒã¯ Synology ã® NAS å†…ã® Docker ã‚³ãƒ³ãƒ†ãƒŠã§å‹•ã‹ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€åŒã˜ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚½ãƒ¼ã‚¹ãŒãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚ã‚‹ãŸã‚ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã‹ã‚‰ NAS ç’°å¢ƒã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹æµã‚Œã§ä½œæ¥­ã—ã¾ã—ãŸã€‚

### ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰

https://github.com/papinianus/PleasanterUpgradeAssistance

ã“ã“ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ â†“ ã‚’å®Ÿè¡Œ

```zsh
deno run --unstable --allow-all main.ts --path /some_directory/web/pleasanter --target 1.3.49.0
```

ã“ã‚Œã§ã‚¢ãƒ—ãƒªãŒæ›´æ–°ã§ããŸçŠ¶æ…‹ã«ãªã‚‹ã®ã§ DB ã‚’æ›´æ–°ã—ã¾ã™ã€‚
Docker ã‚³ãƒ³ãƒ†ãƒŠã§å‹•ä½œã•ã›ã¦ã„ã‚‹ã®ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¦ â†“ ã‚’å®Ÿè¡Œã€‚

```zsh
docker exec -it 'pleasanter ã®ã‚³ãƒ³ãƒ†ãƒŠ' /bin/bash
cd ./Implem.CodeDefiner
dotnet Implem.Codedefiner.dll _rds
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ä½œç¢ºèªã—ã¦å•é¡Œãªã„ã“ã¨ã‚’ç¢ºèª

### NAS ç’°å¢ƒã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰

æµã‚Œã¨ã—ã¦ã¯ã€â†‘ ã§ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ¸ˆã¿ã®ã‚½ãƒ¼ã‚¹ã‚’ NAS ã«ã‚³ãƒ”ãƒ¼ã—ã¦ã€CodeDefiner ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ›´æ–°ã™ã‚‹ã ã‘ã§æ¸ˆã‚€ã€ã¯ãšã§ã—ãŸã€‚

#### docker ã‚’èµ·å‹•ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹

ã¨ã“ã‚ãŒã€ã‚‚ã£ã¦ããŸã‚½ãƒ¼ã‚¹ã‚’èµ·å‹•ã™ã‚‹ã¨ â†“ ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã—ãŸã€‚[^1]

```ash
docker-compose up
web               | Unhandled exception. System.NullReferenceException: Object reference not set to an instance of an object.
web               |    at Implem.DefinitionAccessor.Initializer.ExtendedAutoTestScenarios() in C:\Implem\Pleasanter.NetCore\Implem.DefinitionAccessor\Initializer.cs:line 257
web               |    at Implem.DefinitionAccessor.Initializer.SetParameters() in C:\Implem\Pleasanter.NetCore\Implem.DefinitionAccessor\Initializer.cs:line 97
web               |    at Implem.DefinitionAccessor.Initializer.Initialize(String path, String assemblyVersion, Boolean codeDefiner, Boolean pleasanterTest, Boolean setSaPassword, Boolean setRandomPassword) in C:\Implem\Pleasanter.NetCore\Implem.DefinitionAccessor\Initializer.cs:line 38
web               |    at Implem.Pleasanter.NetCore.Startup..ctor(IConfiguration configuration, IWebHostEnvironment env) in C:\Implem\Pleasanter.NetCore\Implem.Pleasanter\Startup.cs:line 47
web               |    at System.RuntimeMethodHandle.InvokeMethod(Object target, Span`1& arguments, Signature sig, Boolean constructor, Boolean wrapExceptions)
web               |    at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
web               |    at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ConstructorMatcher.CreateInstance(IServiceProvider provider)
web               |    at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.CreateInstance(IServiceProvider provider, Type instanceType, Object[] parameters)
web               |    at Microsoft.AspNetCore.Hosting.GenericWebHostBuilder.UseStartup(Type startupType, HostBuilderContext context, IServiceCollection services, Object instance)
web               |    at Microsoft.AspNetCore.Hosting.GenericWebHostBuilder.<>c__DisplayClass13_0.<UseStartup>b__0(HostBuilderContext context, IServiceCollection services)
web               |    at Microsoft.Extensions.Hosting.HostBuilder.CreateServiceProvider()
web               |    at Microsoft.Extensions.Hosting.HostBuilder.Build()
web               |    at Implem.Pleasanter.NetCore.Program.Main(String[] args) in C:\Implem\Pleasanter.NetCore\Implem.Pleasanter\Program.cs:line 9
web exited with code 139
```

ã“ã®åŸå› ãŒã‚ã‹ã‚‰ãšã€ã‚³ãƒ”ãƒ¼ã‚’ scp ã§ã¯ãªã NAS ã® GUI ã‹ã‚‰å®Ÿè¡Œã—ãŸã‚Šã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ªãƒ¼ãƒŠãƒ¼ã€ã‚°ãƒ«ãƒ¼ãƒ—ã‚„ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’ã„ã˜ã£ãŸã‚Šã—ã¾ã—ãŸãŒã€æœ€çµ‚çš„ã« macOS ã®ãƒªã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãŒåŸå› ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Š â†“ ã®ã‚ˆã†ã«ã™ã‚‹ã¨æ­£å¸¸ã«èµ·å‹•ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚[^2]

```ash
find . -name '._*' | xargs rm
```

ã‚ã¨ã¯ã€CodeDefiner ã‚’ã‹ã‘ã‚Œã°ã€ã‚ã£ã•ã‚Šèµ·å‹•ã—ã¾ã—ãŸã€‚

![ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¡¨è¨˜ã®ã‚­ãƒ£ãƒ—ãƒãƒ£](/images/b40583763bef96.png =300x)

#### å¯¾ç­–

ã“ã“ã§ã¯ã€ãƒªã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¾Œã‹ã‚‰æ¶ˆã™ã¨ã„ã†ã“ã¨ã‚’ã‚„ã‚Šã¾ã—ãŸãŒã€äº‹è±¡ãŒåˆ†ã‹ã£ã¦ã„ã‚Œã°æ¬¡ã®ã‚ˆã†ãªæ–¹æ³•ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å¯¾å¿œã™ã‚‹ã“ã¨ã§å‹•ä½œã™ã‚‹ç’°å¢ƒä¸Šã§ä½™è¨ˆãªä½œæ¥­ã‚’ã—ãªãã¦ã™ã¿ã¾ã™ã€‚

- ãƒªã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚ãšã«åœ§ç¸®ã™ã‚‹
  - `COPYFILE_DISABLE=1 tar -zcf pleasanter.tar.gz --exclude ".DS_Store" pleasanter`
- gnutar ã‚’ä½¿ã†
  - `brew install gnu-tar`
  - `gtar -zvcf pleasanter.tar.gz pleasanter`

## ã¾ã¨ã‚

- å»å¹´ä½œã£ãŸãƒ„ãƒ¼ãƒ«ãŒå‹•ã„ã¦æº€è¶³
  - æœ¬å®¶ã®ã‚µã‚¤ãƒˆãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã‚’éš è”½ã—ã¦ã‚‹ã®ã§ã€ãƒ„ãƒ¼ãƒ«ä½œã£ã¨ã„ã¦ãƒ›ãƒ³ãƒˆã‚ˆã‹ã£ãŸ
- æ„å‘³ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸã¨ãã‚‚è‰²ã€…ã¨æ¢ã£ã¦ã¿ã‚‹ã¨æ¡ˆå¤–ãªã‚“ã¨ã‹ãªã‚‹
  - ã‚ã‚“ã¾ã‚Š mac ã§ç’°å¢ƒæ§‹ç¯‰ã—ã¦æœ¬ç•ªã«æŒã£ã¦ã„ãäººã¯ã„ãªã„ã¨æ€ã†ãŒã€ã‚‚ã—ã‹ã—ã¦èª°ã‹åŒã˜å•é¡Œã‚’ã‹ã‹ãˆãŸäººã«ãƒ’ãƒ³ãƒˆã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

[^1]: NAS ã® docker ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„ãŸã‚ `docker-compose` ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

```ash
docker --version
Docker version 20.10.3, build 55f0773
```

[^2]: å®Ÿéš›ã«ã¯["SentAcceptanceMail .json"](https://github.com/Implem/Implem.Pleasanter/blob/main/Implem.Pleasanter/App_Data/Displays/SentAcceptanceMail%20.json)ã¨ã„ã†ã‚¹ãƒšãƒ¼ã‚¹ã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ãŒãã®ã¾ã¾ã§ã¯ã†ã¾ãæ¶ˆã›ãªã‹ã£ãŸã®ã§ã€å€‹åˆ¥ã«å‰Šé™¤ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã—ãŸã€‚
