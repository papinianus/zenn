---
title: 'Pleasanter ã® 1.5 å¹´ã®é€²æ­©'
emoji: 'ğŸŠ'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['pleasanter']
published: true
---

## ç›®çš„

- Pleasanter ãŒã“ã® 1.5 å¹´ã§ã©ã®ç¨‹åº¦é€²æ­©ã—ãŸã‹ã‚’å…·ä½“çš„ã«æ„Ÿã˜å–ã‚‹

### é¡Œæ

https://qiita.com/YoshikiSawada/items/f5b2416fed9661a7727c

ã“ã®è¨˜äº‹ã®

> ãƒ—ãƒªã‚¶ãƒ³ã‚¿ãƒ¼ã®ä¸€è¦§ç”»é¢ã§é¸æŠã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡ã™ã‚‹æ–¹æ³•

ã‚’ãƒ™ãƒ¼ã‚¹ã«ã©ã®ã‚ˆã†ãªæ©Ÿèƒ½æ”¹å–„ãŒã‚ã‚Šã€ã©ã†ã„ã†æ”¹å–„ãŒã§ãã‚‹ã‹ã‚’æ¤œè¨ã™ã‚‹

## å®Ÿè£…

### ãƒœã‚¿ãƒ³é…ç½®

- æ®‹å¿µãªãŒã‚‰ä»Šç¾åœ¨ã‚‚ã€ã‚µã‚¤ãƒˆ(ãƒ†ãƒ¼ãƒ–ãƒ«)ã«ãƒœã‚¿ãƒ³ã‚’å‡ºã™ã«ã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå¿…è¦
  - ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã¯ã€ãƒ—ãƒ­ã‚»ã‚¹æ©Ÿèƒ½ã§ãƒœã‚¿ãƒ³é…ç½®ã§ãã‚‹
  - ãƒ—ãƒ­ã‚»ã‚¹ã®ä¸€æ‹¬æ©Ÿèƒ½ã¯ã€ã€Œä¿å­˜ã€ã®ãƒœã‚¿ãƒ³ã®ã¿ãŒå‡ºã‚‹ãŸã‚ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã¯é©ã•ãªã„

ã¨ã„ã†ã“ã¨ã§ã€å…ˆã®è¨˜äº‹ã‚’åˆ©ç”¨ã•ã›ã¦ã„ãŸã ãã€ã“ã† â†“

```javascript
$p.events.on_grid_load = () => {
  const sendButton =
    '<button id="post" class="button button-icon ui-button ui-corner-all" type="button"><span class="ui-icon ui-icon-circle-arrow-n"></span>é€ä¿¡</button>';

  document
    .getElementById('MainCommands')
    .insertAdjacentHTML('beforeend', sendButton);

  document.getElementById('post').onclick = () => sendSelected();
};
```

ãªãŠã€å…ˆã®è¨˜äº‹ã®ã‚³ãƒ¼ãƒ‰ã‚³ãƒ¡ãƒ³ãƒˆã«ã¯

> // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®å³ã«ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 

ã¨ã‚ã‚‹ãŒã€ãƒ“ãƒ¥ãƒ¼ã®æ©Ÿèƒ½ã‚„ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã«ã‚ˆã£ã¦ã¯ "MainComands" ã«ã¯ã€Œã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€ãŒãªã„å ´åˆãŒã‚ã‚‹ã€‚ã—ã‹ã—ã€å®Ÿè£…ã¯ã€è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒœã‚¿ãƒ³ã«ä¾å­˜ã—ãªã„ãŸã‚å•é¡Œãªãå‹•ä½œã™ã‚‹ã€‚

### é€ä¿¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

å…ˆã®è¨˜äº‹ã®å®Ÿè£…ã®å•é¡Œã¨ã—ã¦ã€ä¸€è¦§ã®ä»¶æ•°ãŒ 20 ä»¶ã‚’è¶…ãˆã¦ãŠã‚Šã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å…¨ã¦ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å ´åˆã€å…¨é¸æŠã‚’ã—ãŸçµæœãŒæ­£ã—ããªã„ã“ã¨ãŒè‡´å‘½çš„ã€‚

ã“ã®å ´åˆ [$p.selectedIds()](https://pleasanter.org/manual/script-selected-ids) ã‚’ä½¿ã†ã“ã¨ã§ã€æœŸå¾…ã® ID ãŒå–ã‚Œã‚‹ã®ã§ â†“

```javascript
const apiGetPromisify = (siteId, resultIds) => {
  return new Promise((resolve, reject) => {
    $p.apiGet({
      id: siteId,
      data: {
        View: {
          ColumnFilterHash: { ResultId: JSON.stringify(resultIds) },
          ApiDataType: 'KeyValues',
          GridColumns: ['ResultId', 'Title'],
        },
      },
      done: function (data) {
        resolve(data);
      },
      fail: function (data) {
        reject(data);
      },
    });
  });
};

const sendSelected = async () => {
  const rows = $p.selectedIds();
  if (rows.length < 1) {
    return;
  }
  const dats = (await apiGetPromisify($p.siteId(), rows)).Response.Data;
  const json = await (
    await fetch('http://httpbin.org/post', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json;charset=UTF-8',
      },
      body: JSON.stringify(dats),
    })
  ).json();
  console.log(json);
};
```

- åœ°å‘³ã« `ApiDataType: 'KeyValues',` ã‚‚æ¯”è¼ƒçš„æœ€è¿‘ã®æ©Ÿèƒ½ã€‚fetch ã§é€£æºã™ã‚‹å…ˆãŒ Pleasanter å›ºæœ‰ã®ã‚«ãƒ©ãƒ åã«ä¾å­˜ã—ãªãã¦ã™ã‚€ã€‚
- ID ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãªã„ã®ã¨åŒã˜ãã€Title ã‚‚ç”»é¢ã‹ã‚‰å–ã‚Œã‚‹ä¿è¨¼ã¯ãªã„ã®ã§ã€API ã§å–ã‚‹ã»ã‹ãªã„ã€‚
  - å ´åˆã«ã‚ˆã£ã¦ã¯ fetch ã§é€£æºã•ã›ã‚‹å…ˆã«ã¯ ID ã ã‘æ¸¡ã—ã¦ã€ãã¡ã‚‰ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šç›´ã—ã¦ã‚‚ã‚‰ã£ãŸã»ã†ãŒç”»é¢ã®å¿œç­”ã¯æ—©ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚

## ãŠã‚ã‚Šã«

- ä¸€è¦§è¡¨ã§ç”»é¢ã‚’ã‚«ã‚¹ãƒã‚¤ã‚ºã™ã‚‹ã“ã¨ã«ã¤ã„ã¦ã¯ã€ç›®ç«‹ã£ãŸé€²åŒ–ã¯ãªã„
  - é€†ã«ã€ç·¨é›†ç”»é¢ã¯ã€ãƒ—ãƒ­ã‚»ã‚¹ã‚„ã‚¨ãƒ‡ã‚£ã‚¿ã®ç‰¹å®šã®é …ç›®ã®æ‹¡å¼µ HTML ãªã©ã€é€²æ­©ã—ã¦ã„ã‚‹
  - ã“ã®ã¨ã“ã‚ã¯ä»Šå¾Œã®èª²é¡Œ
- API ã®æ©Ÿèƒ½ã¯æœ€è¿‘ã®æ›´æ–°ã§ã‚‚æ©Ÿèƒ½è¿½åŠ ã®å¤šã„ã¨ã“ã‚ãªã®ã§ã€æ‹¡å¼µ SQL ã‚„åŠ›æŠ€ã‚’ä½¿ã£ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å›é¿ã§ããã†
