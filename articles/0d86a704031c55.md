---
title: 'LINQ ã®è¨˜äº‹èª­ã¿ä¸‹ã—'
emoji: 'ğŸŠ'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['csharp', 'LINQ']
published: true
---

# ã“ã‚Œã¯ãªã«

https://zenn.dev/tessecraft_r/articles/22ec87f2c1ea9c

ãŒåˆ†ã‹ã‚‰ãªã‹ã£ãŸã®ã§è€ƒãˆãŸã€‚

## ã¾ã¨ã‚

- string ãŒã‚­ãƒ£ãƒ—ãƒãƒ£ã•ã‚Œã¦ã‚‹
- `return new` ã£ã¦ãªã«?
  - `return new` ã—ã¦ã‚‚è©•ä¾¡ã•ã‚Œã¦ãªã„

ä»¥ä¸‹ã€ãŠã‚‚ã« return new å•é¡Œã‚’è€ƒãˆã‚‹

## `return new` ã—ãŸã‚‰è©•ä¾¡ã•ã‚Œã‚‹ã€ã¨ã¯ã€‚

> keyValues ã®å€¤ã¯ return new ã™ã‚‹ã¨ãã¾ã§è©•ä¾¡ã•ã‚Œã¾ã›ã‚“ã€‚
> ã¨ã„ã†ã“ã¨ã¯ã€return new ã™ã‚‹ã¾ã§ cText ã«ã¯ä½•ã‚‚ä»£å…¥ã•ã‚Œãªã„ã®ã§ã€cText ã¯å®£è¨€ã•ã‚ŒãŸã¨ãã®å€¤ã®ã¾ã¾ã§ã™ã€‚
> ãªã®ã§ã€return new ã™ã‚‹å‰ã« ToArray ã¨ã‹ã—ã¦æ˜ç¤ºçš„ã«è©•ä¾¡ã—ã¦ã‚ã’ã¾ã™ã€‚

ã¨ã‚ã‚‹ãŒã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã«ã¯ 2 ã¤ã® `return new` ãŒã‚ã£ã¦ã€ä¸€ã¤ã¯ Select å†…ã® Func ã§ã® `return new` ã§ã‚‚ã†ä¸€ã¤ãŒ `SplitColonKV` ã®å€¤ã‚’æ±ºã‚ã‚‹ `return new`

çµè«–ã¨ã—ã¦ `keyValues` ã®å³è¾ºã‚’ `.ToArray()` ã—ã¦ã„ã‚‹ã®ã§ã€ç­†è€…ãŒã„ã† `return new` ã¯ `SplitColonKV` ã®æœ€çµ‚è¡Œã® `return new` ã ã¨è§£é‡ˆã—ãŸã€‚

ãŸã ã©ã¡ã‚‰ã® `return new` ã ã¨ã—ã¦ã‚‚ `return new` ã§å€¤ã®è©•ä¾¡ã¯å½“ç„¶ã«ã¯èµ·ããªã„ã€‚

### `Enumerable.Select` ã® `return`

ã¾ãš Select ã® `return new` ã¯ã€LINQ ã®è©•ä¾¡ãŒèµ·ããŸã¨ãã«ã€å…ƒã® IEnumerable<T> ã®ã‚½ãƒ¼ã‚¹ã‚’ä½•ã«ãƒãƒƒãƒ—ã™ã‚‹ã‹ãªã®ã§ã€`return new` ãŒæ›¸ã„ã¦ã‚ã‚‹ã‹ã‚‰ã¨ã„ã£ã¦è©•ä¾¡ã¯ã•ã‚Œãªã„ã€‚

### `SplitColonKV` ã® `return`

ã¤ãã« `SplitColonKV` ã®æœ«å°¾ã® `return new` ã§ã‚‚è©•ä¾¡ã¯ã€å½“ç„¶ã«ã¯èµ·ããªã„ã€‚

ç°¡å˜ã«ã¯ SharpLab ã§ Dump ã—ãŸçµæœã®å‹ã§ç¢ºèªã§ãã‚‹ã€‚

https://sharplab.io/#v2:C4LgTgrgdgNAJiA1AHwAICYCMBYAUKgBgAJVMA6AGQEsoBHAbjzwHsAjAKwFMBjYIgZQAOAGyrAAws2HMoAaQBqAClLEA2gF0icAIbBt/YGBoBzAM4BKPAG88ASBVFuAFU4APPgF4iAIm+NctgBu2mBEANacAJ7y2sIQnKZEXjp6BkZQZna2ZPycwjzAiq5JAHxENgG2QSHhUTFxnElErjkiYooA5CAd5v5V1aERkU1D9fFkAGJUYKbAAPJgACKcAGbaEMKFvVkDRMENI3Wx4wCi+QC2nFDAAILzS6vrm4qY25W2VCuKQ0le3tzeSzvCr9WzONyePbHTh9KoAXx2qAA7EQoJwAO47EH9WRRQ6RGA7WxjRpefbxHZw2Fwt62OzI1EYuzY8HuQmVUbQ0zs2xUvAI3B4VAAFiIAFltDRFECQcFQil9IYTIkvGj0SRMAQNMyst5tCBtIajd4ebZvKwQKwrdaTbruCBuI6nbbKt4EHAPZ6XVVvJwQJwA4HvXyAnYhKIJFIZApFAq0sqgdlFhBzoJpf4BXgJVLekA=

> { cText = , keyValues = System.Linq.Enumerable+SelectArrayIterator`2[System.String,<>f\_\_AnonymousTyâ€¦

ã¨ãªã£ã¦ãŠã‚Š `keyValues` ã¯ `Iterator` ã¨ã—ã¦ä¿æŒã•ã‚Œã¦ã„ã‚‹ã€‚

ã“ã‚Œã«å¯¾ã—ã¦è©•ä¾¡ã•ã‚ŒãŸå ´åˆã®å‹ã¯

```csharp
using System;
using System.Linq;

object SplitColonKV(string [] dataStrings)
{
	string cText = "";
	var keyValues = dataStrings
		.Select(x => {
			var keyValue = x.Split(':');
			var key = keyValue.FirstOrDefault();
			var value = keyValue.ElementAtOrDefault(1);
			if(key == "c")
			{
				cText = value;
			}
			return new
			{
				Key = key,
				Value = value
			};
		});

	return new
	{
		cText = cText,
		keyValues = keyValues.ToArray(),
	};
}

void Main()
{
	var dataStrings = new string[]
	{
		"a:aaaaaa",
		"b:bbbbbb",
		"c:cccccc",
		"d:dddddd",
		"e:eeeeee",
	};

	SplitColonKV(dataStrings)
	.Dump();
}

Main();
```

https://sharplab.io/#v2:C4LgTgrgdgNAJiA1AHwAICYCMBYAUKgBgAJVMA6AGQEsoBHAbjzwHsAjAKwFMBjYIgZQAOAGyrAAws2HMoAaQBqAClLEA2gF0icAIbBt/YGBoBzAM4BKPAG88ASBVFuAFU4APPgF4iAIm+NctgBu2mBEANacAJ7y2sIQnKZEXjp6BkZQZna2ZPycwjzAiq5JAHxENgG2QSHhUTFxnElErjkiYooA5CAd5v5V1aERkU1D9fFkAGJUYKbAAPJgACKcAGbaEMKFvVkDRMENI3Wx4wCi+QC2nFDAAILzS6vrm4qY25W2VCuKQ0le3tzeSzvCr9WzONyePbHTh9KoAXx2qAA7EQoJwAO47EH9WRRQ6RGA7WxjRpefbxHZw2Fwt62OzI1EYuzY8HuJqs4CEyqjaGJLw8hqmMhOZg3MBgbSRRTmLm2Kl4BG4PCoAAsRAAstoaNLrHZgqEUvpDCY+Yz0SRMAQNMyst5tCBtI6nd5ZbZvKwQKwvd6XbbuCBuIGg77Kt4EHAI5GQ1VvJwQJwE4no/KAnYhKIJFIZApFIa0iagdlFhBzoJpf5FXhNdrekA=

> { cText = , keyValues = <>f\_\_AnonymousType0`2[System.String,System.String][] }

ã§ã‚ã‚‹ã€‚

ãŸã ã€ã“ã®ã¨ãã§ã™ã‚‰ã€cText ã¯ string.Empty ã¨ãªã£ã¦ã„ã‚‹ã€‚

ã¤ã¾ã‚Šã€æœ¬è³ªçš„ã«ã¯ cText ãŒã‚­ãƒ£ãƒ—ãƒãƒ£ã•ã‚Œã‚‹å‰ã«è©•ä¾¡ã‚’èµ·ã“ã›ã°ã‚ˆã„ã®ã§å¿…è¦ãŒã‚ã‚‹ã®ã§ã€`return new` ã®é †åºã‚’å…¥ã‚Œæ›ãˆã‚‹ã ã‘ã§å‹•ä½œãŒã‹ã‚ã‚‹ã€‚

```javascript
using System;
using System.Linq;

object SplitColonKV(string [] dataStrings)
{
	string cText = "";
	var keyValues = dataStrings
		.Select(x => {
			var keyValue = x.Split(':');
			var key = keyValue.FirstOrDefault();
			var value = keyValue.ElementAtOrDefault(1);
			if(key == "c")
			{
				cText = value;
			}
			return new
			{
				Key = key,
				Value = value
			};
		});

	return new
	{
		keyValues = keyValues.ToArray(),
		cText = cText,
    };
}

void Main()
{
	var dataStrings = new string[]
	{
		"a:aaaaaa",
		"b:bbbbbb",
		"c:cccccc",
		"d:dddddd",
		"e:eeeeee",
	};

	SplitColonKV(dataStrings)
	.Dump();
}

Main();
```

https://sharplab.io/#v2:C4LgTgrgdgNAJiA1AHwAICYCMBYAUKgBgAJVMA6AGQEsoBHAbjzwHsAjAKwFMBjYIgZQAOAGyrAAws2HMoAaQBqAClLEA2gF0icAIbBt/YGBoBzAM4BKPAG88ASBVFuAFU4APPgF4iAIm+NctgBu2mBEANacAJ7y2sIQnKZEXjp6BkZQZna2ZPycwjzAiq5JAHxENgG2QSHhUTFxnElErjkiYooA5CAd5v5V1aERkU1D9fFkAGJUYKbAAPJgACKcAGbaEMKFvVkDRMENI3Wx4wCi+QC2nFDAAILzS6vrm4qY25W2VCuKQ0le3tzeSzvCr9WzONyePbHTh9KoAXx2qAA7EQoJwAO47EH9WRRQ6RGA7WxjRpefbxHZw2Fwt62OzI1EYuzY0bQxJeVkNUxkJzMG5gMDaSKKcyEyrg9xNCXAMVEOVEKl4BG4PCoAAsRAAstoaCLrHZgqEUvpDCZ2Yz0SRMAQNMyst5tCBtM6Xd4xVVvKwQKwfb63fbuCBuMGQ/7Kt4EHAo9Gwx7OCBOImk7HFQE7EJRBIpDIFIpjWkzUDsosIOdBCL/Mq8Nrdb0gA===

> { keyValues = <>f\_\_AnonymousType0`2[System.String,System.String][], cText = cccccc }

å¾“ã£ã¦ `return new` ã—ãŸã‹ã‚‰ã¨ã„ã£ã¦è©•ä¾¡ã•ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„ã—ã€`return new` ã®å‰ã«è©•ä¾¡ã—ã¦ã‚‚æ„å‘³ãŒãªã `cText` ãŒå›ºå®šã™ã‚‹ã¾ã§ã«è©•ä¾¡ã‚’èµ·ã“ã™å¿…è¦ãŒã‚ã‚‹ã€‚

ã‚ã‚‹ã„ã¯ã€ã¾ãŸ `cText` ã‚’å‚ç…§å‹ã«ã™ã‚Œã°ã€äº‹å¾Œçš„ã« `keyValues` ã‚’è©•ä¾¡ã™ã‚‹ã“ã¨ã§ã€`return new` ã®ã•ã‚‰ã«å¾Œã‹ã‚‰ `cText` ã‚’æ›¸ãæ›ãˆã‚‹ã“ã¨ã‚‚å¯èƒ½ã¨ãªã‚‹ã€‚

```csharp
using System;
using System.Linq;
using System.Collections.Generic;

object SplitColonKV(string [] dataStrings)
{
	var cText = new string[1]{""};
	var keyValues = dataStrings
		.Select(x => {
			var keyValue = x.Split(':');
			var key = keyValue.FirstOrDefault();
			var value = keyValue.ElementAtOrDefault(1);
			if(key == "c")
			{
				cText[0] = value;
			}
			return new
			{
				Key = key,
				Value = value
			};
		});

	return new
	{
		cText,
		keyValues,
    };
}

void Main()
{
	var dataStrings = new string[]
	{
		"a:aaaaaa",
		"b:bbbbbb",
		"c:cccccc",
		"d:dddddd",
		"e:eeeeee",
	};

	var obj = SplitColonKV(dataStrings);

    foreach(var prop in obj.GetType().GetProperties())
    {
        var content = prop.GetValue(obj) as IEnumerable<object>;
        if(content != null)
        {
            foreach(var i in content) {
                Console.WriteLine(prop.Name);
                Console.WriteLine(i);
            }
        }
    }
    foreach(var prop in obj.GetType().GetProperties())
    {
        var content = prop.GetValue(obj) as IEnumerable<object>;
        if(content != null)
        {
            foreach(var i in content) {
                Console.WriteLine(prop.Name);
                Console.WriteLine(i);
            }
        }
    }
}

Main();
```

https://sharplab.io/#v2:C4LgTgrgdgNAJiA1AHwAICYCMBYAUKgBgAJVMA6AGQEsoBHAbj0JMwBZHc8B7AIwCsApgGNgRAMoAHADZVgAYS5SuUANIA1ABSliAbQC6ROAENgRscDA0A5gGcAlHgDeeAJAA3I2CJCAKgIAeogC8RFACAO4sBDqYeo4ARPEAvhzunkQA1gIAnmpGUhACNkQhxqbmllC2ri5kYgJSwsAa/iUAfETOuC49Hl5ZufmFJUT+ddKyGgDkIFN2qb3pAyMDeQUCZABiVGA2wADyYAAiAgBmRhBSzfM1aV4e6ys5a4VkAKKNALYCUMAAggdjmcLlcNJgbt0elRThplkEQvEhPEHJCXF0ej1fAFgDoCAYQg9CgsXElbqgAOyhCK3dEYlQ5J7ZGC3FwvAQjQkCW4pGpJCEuVwUqnhVy0rGBZmQ1ZDIqSojyog83Ckzj4VhEACyRhoGhR6L6hhMZgs1mKITCkW0+lFNXiRhARkdTvikp68R4IB4Xu9LttQhAQkDQd9kPiCDgEcjIbdAhAAnjCejSoF3QNvD4I0kMnkimU6g0ZWNlVsEIVRDwZdOXDAAiMQgAFhoDRIwFwJEQaER02QAOICYA+bISAS63v9gAKreHYGAVCKupRZa6ZbLBqEymAP2CRBbbbHwDZGnTdiIRmKpAAzAAedNNNocFcK6Eade/LdEACE5suUkXj86CoVv+lbVrWDZNukVAdlA3gbluJ7LsB/6kAAnBou4SGQAByRjfKWSGPqhGhUPhBEqsB5EKpR8pVjWdaNs2U7QV2/D7oOw6jn2wCTm2AgznONgLkB8qIY+a5wb8IwYfuh7Hqe56YNet4iPewkrs+r6bpJX6hD+f6Po4gG4ARNGgfREFeFBnaafBnRqSZLBodJOF4Q+DkKkRJFuWR9lUWpKoqngWo6vMQA

- å‡ºåŠ›

```text
cText

keyValues
{ Key = a, Value = aaaaaa }
keyValues
{ Key = b, Value = bbbbbb }
keyValues
{ Key = c, Value = cccccc }
keyValues
{ Key = d, Value = dddddd }
keyValues
{ Key = e, Value = eeeeee }
cText
cccccc
keyValues
{ Key = a, Value = aaaaaa }
keyValues
{ Key = b, Value = bbbbbb }
keyValues
{ Key = c, Value = cccccc }
keyValues
{ Key = d, Value = dddddd }
keyValues
{ Key = e, Value = eeeeee }
```

1 åº¦è©•ä¾¡ãŒèµ·ã“ã£ãŸå¾Œã®ãƒ«ãƒ¼ãƒ—ã§ã¯ cText ã«å€¤ãŒå…¥ã£ã¦ã„ã‚‹ã€‚
äº‹å‰ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒåˆ†ã‹ã‚‰ãªã„ object ã§ç¢ºå®Ÿã«åˆ—æŒ™ã‚’èµ·ã“ã™æ–¹æ³•ãŒã“ã‚Œãã‚‰ã„ã—ã‹æ–¹æ³•ãŒæ€ã„ã¤ã‹ãªã‹ã£ãŸãŒã€è¦ã¯ cText ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã‚Šå…ˆã« keyValues ã®çµæœã‚’å–å¾—ã—ã¦ã„ã‚Œã°å•é¡Œãªã„ã€‚

## ã•ã„ã”ã«

- `return new` ã«ã‚ˆã£ã¦ã‚‚ LINQ ã®è©•ä¾¡ã¯å½“ç„¶ã«ã¯èµ·ã“ã‚‰ãªã„ã€‚
- é–¢æ•°ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ `return` ã§æŠœã‘ãŸã•ã‚‰ã«ãã®å¾Œã§ LINQ ã®è©•ä¾¡ã‚’èµ·ã“ã—ã¦ã€å€¤ã®å¤‰åŒ–ã‚’ä»–ã®å¤‰æ•°ã«æ³¢åŠã•ã›ã‚‹ã“ã¨ã¯å¯èƒ½ã€‚

çµå±€å¤‰æ•°ã®ã‚¹ã‚³ãƒ¼ãƒ—ã®å•é¡Œã§ã‚ã‚Šã€ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ã§ã‚ã‚‹ string ãŒ return ã®ã¨ãã«ã€å€¤ã‚’å›ºå®šã•ã‚ŒãŸã“ã¨ãŒã‚­ãƒ¢ã€‚LINQ ã˜ã‚ƒãªã string ãŒã‚ã‹ã£ã¦ãªã‹ã£ãŸã¨è¦‹ã‚‹ã¹ãã€‚

- Select ã§å‰¯ä½œç”¨ã‚’èµ·ã“ã™ã‚³ãƒ¼ãƒ‰ã¯ã‚„ã‚ãŸã»ã†ãŒç„¡é›£ã€‚
